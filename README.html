<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏´‡∏°‡∏≤‡∏Å‡∏Æ‡∏≠‡∏™‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠+AI‡πÅ‡∏£‡∏á‡∏™‡∏∏‡∏î</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
  html,body{margin:0;padding:0;height:100vh;overflow:hidden;background:#111;display:flex;flex-direction:column;align-items:center;}
  h1,p{margin:1vh 0 .5vh;font-size:4.5vw;color:#fff;}
  #board{position:relative;width:96vw;height:96vw;max-width:96vh;max-height:96vh;background:#333;display:grid;grid-template:repeat(8,1fr)/repeat(8,1fr);}
  .cell{position:relative;}
  .cell:nth-child(even){background:#f0d9b5;}
  .cell:nth-child(odd){background:#b58863;}
  .piece{position:absolute;width:90%;height:90%;border-radius:50%;top:5%;left:5%;transition:transform .3s;}
  .player{background:#e74c3c;}
  .bot{background:#2ecc71;}
  .king:before{content:"";position:absolute;top:20%;left:20%;width:60%;height:60%;border-radius:50%;background:rgba(255,255,255,0.4);}
  .selected .piece{outline:3px solid yellow;}
  #message{margin-top:1vh;font-size:3.5vw;color:gold;}
</style>
</head>
<body>
<h1>‡∏´‡∏°‡∏≤‡∏Å‡∏Æ‡∏≠‡∏™ + AI 10 ‡πÄ‡∏ó‡πà‡∏≤ ‚ôï</h1><p>üî¥ ‡∏Ñ‡∏∏‡∏ì vs üü¢ ‡∏ö‡∏≠‡∏ó</p>
<div id="board"></div><div id="message"></div>

<script>
// ... (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô) ...

const SIZE=8, board=[], boardEl=document.getElementById('board'), msg=document.getElementById('message');
let turn='P', selected=null, mustContinue=false;

function init() {
  boardEl.innerHTML='';
  for(let i=0;i<64;i++){ const div=document.createElement('div'); div.className='cell'; boardEl.appendChild(div); }
  createBoard(); draw();
}

function createBoard(){
  for(let r=0;r<SIZE;r++){
    board[r]=[];
    for(let c=0;c<SIZE;c++){
      board[r][c]=(r<3 && (r+c)%2? 'B': r>4 && (r+c)%2? 'P':'');
    }
  }
}

function draw(){
  Array.from(boardEl.children).forEach((cell,i)=>{
    const r=Math.floor(i/8), c=i%8;
    cell.innerHTML='';
    const p=board[r][c];
    if(p){
      const el=document.createElement('div');
      el.className='piece '+(p.toUpperCase()==='P'?'player':'bot')+(p==='p'||p==='b'?' king':'');
      const [nr,nc]=getPos(r,c);
      el.style.transform=`translate(${nc*100}%,${nr*100}%)`;
      cell.appendChild(el);
    }
    if(selected?.r===r && selected?.c===c) cell.classList.add('selected');
    else cell.classList.remove('selected');
  });
}

function clickEvent(e){
  if(turn!=='P') return;
  const i=[...boardEl.children].indexOf(e.currentTarget);
  const r=Math.floor(i/8), c=i%8, p=board[r][c];
  if(p.toUpperCase()==='P'){
    selected={r,c}; mustContinue=false; msg.innerText=''; draw();
  } else if(selected){
    const moves=legal(selected.r,selected.c,'P');
    const target=moves.find(m=>m.r===r&&m.c===c);
    if(!target) return;
    if(mustContinue && selected?.r!==r) return;
    makeMove(selected,target,false);
  }
}

function getPos(r,c){return [r,c];}

function legal(r,c,pl){
  const dirs=pl==='P'? [[-1,-1],[-1,1]]:[[1,-1],[1,1],[-1,-1],[-1,1]];
  const arr=[];
  dirs.forEach(d=>{
    const [dr,dc]=d, nr=r+dr, nc=c+dc;
    if(inBound(nr,nc) && board[nr][nc]==='') arr.push({r:nr,c:nc,kind:'move'});
    const jr=r+2*dr, jc=c+2*dc;
    if(inBound(jr,jc)&&board[jr][jc]===''&&board[nr][nc]&&board[nr][nc].toUpperCase()!==pl){
      arr.push({r:jr,c:jc,kind:'eat'});
    }
  });
  return arr;
}

function mustEat(pl){
  return board.flatMap((row,r)=>
    row.flatMap((p,c)=>p.toUpperCase()===pl ? legal(r,c,pl).filter(m=>m.kind==='eat').map(m=>({r,c,...m})) : [])
  );
}

function makeMove(from,to,isBot){
  const {r:cfr, c:cfc} = from;
  const {r:tr, c:tc, kind} = to;
  const p=board[cfr][cfc];
  board[cfr][cfc]=''; board[tr][tc]=p;
  if(kind==='eat') {
    const mr=(cfr+tr)/2, mc=(cfc+tc)/2;
    board[mr][mc]='';
  }
  // mother conversion
  if((p==='P' && tr===0) || (p==='B' && tr===SIZE-1)) board[tr][tc]=p.toLowerCase();
  draw();
  if(kind==='eat' && legal(tr,tc,p.toUpperCase()).some(m=>m.kind==='eat')){
    mustContinue=true; selected={r:tr,c:tc}; msg.innerText='üç¥ ‡∏Å‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢!';
    if(!isBot) return;
  }
  turn = isBot? 'P':'B';
  selected=null; mustContinue=false; msg.innerText='';
  if(!isBot) setTimeout(botTurn,200);
}

async function botTurn(){
  const move = minimax(board,4,true).move;
  makeMove(move.from,move.to,true);
}

function minimax(bd,depth,isMax){
  if(depth===0) return {score:evalBoard(bd),move:null};
  const pl = isMax? 'B':'P';
  const moves = allMoves(bd,pl);
  let best = isMax? {score:-Infinity}: {score:Infinity};
  for(const m of moves){
    const bd2 = copyBoard(bd);
    apply(bd2,m);
    const res = minimax(bd2,depth-1,!isMax);
    if(isMax? res.score>best.score : res.score<best.score){ best={score:res.score,move:m}; }
  }
  return best;
}

function allMoves(bd, pl){
  const arr = [];
  bd.forEach((row,r)=> row.forEach((p,c)=>{ if(p.toUpperCase()===pl) legal(r,c,pl).forEach(m=>{
    arr.push({from:{r,c},to:m});
  })}));
  return arr;
}

function apply(bd,m){
  const {r:cfr,c:cfc}=m.from, {r:tr, c:tc, kind}=m.to;
  const p=bd[cfr][cfc];
  bd[cfr][cfc]=''; bd[tr][tc]=p;
  if(kind==='eat'){ const mr=(cfr+tr)/2, mc=(cfc+tc)/2; bd[mr][mc]=''; }
  if((p==='P'&&tr===0)||(p==='B'&&tr===7)) bd[tr][tc]=p.toLowerCase();
}

function evalBoard(bd){
  let s=0;
  bd.flat().forEach(p=>{
    if(p) s += p.toUpperCase()==='P'? (p===p.toLowerCase()?5:3) : (p===p.toLowerCase()?-5:-3);
  });
  return s;
}

function copyBoard(bd){return bd.map(r=>r.slice());}
function inBound(r,c){return r>=0&&c>=0&&r<SIZE&&c<SIZE;}

boardEl.childNodes.forEach(cell=>cell.onclick=clickEvent);
init();
</script>
</body>
</html>